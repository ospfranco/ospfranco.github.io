<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico"/>
  <link type="application/atom+xml" rel="alternate" href="https://ospfranco.github.io/feed.xml" title="Oscar's Blog" /> <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Stop using redux, mobx and/or context | Oscar‚Äôs Blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Stop using redux, mobx and/or context" />
<meta name="author" content="Oscar Franco" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Stop writing state management code" />
<meta property="og:description" content="Stop writing state management code" />
<link rel="canonical" href="https://ospfranco.github.io/post/2020/07/15/why-i-stopped-using-redux,-mobx-and-context-(mostly)/" />
<meta property="og:url" content="https://ospfranco.github.io/post/2020/07/15/why-i-stopped-using-redux,-mobx-and-context-(mostly)/" />
<meta property="og:site_name" content="Oscar‚Äôs Blog" />
<meta property="og:image" content="https://ospfranco.github.io/assets/marble2.JPG" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-15T15:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ospfranco.github.io/assets/marble2.JPG" />
<meta property="twitter:title" content="Stop using redux, mobx and/or context" />
<meta name="twitter:site" content="@ospfranco" />
<meta name="twitter:creator" content="@Oscar Franco" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ospfranco.github.io/assets/taco.png"},"name":"Oscar Franco"},"url":"https://ospfranco.github.io/post/2020/07/15/why-i-stopped-using-redux,-mobx-and-context-(mostly)/","image":"https://ospfranco.github.io/assets/marble2.JPG","headline":"Stop using redux, mobx and/or context","dateModified":"2020-07-15T15:00:00+02:00","datePublished":"2020-07-15T15:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ospfranco.github.io/post/2020/07/15/why-i-stopped-using-redux,-mobx-and-context-(mostly)/"},"author":{"@type":"Person","name":"Oscar Franco"},"description":"Stop writing state management code","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/css/site.css" />
</head>
<html>
  <body>
    <div class="overflow-y-scroll flex justify-center pt-16 pb-4">
      <div class="content">
        <div class="py-12 px-4">
  <h1 class="font-semibold text-2xl text-center">Stop using redux, mobx and/or context</h1>
  <div class="text-gray-500 text-center">
    July 2020
  </div>
  
  <div class="markdown mt-6">
    <p>This has been one of the biggest changes in the way I build apps and I didn‚Äôt quite realize myself what it meant from the beginning.</p>

<h2 id="why-not-mobxreduxrecoilcontextreduxsagasusereducer">Why not [MobX|Redux|Recoil|Context|ReduxSagas|UseReducer]?</h2>
<p>So you probably already now the world of state management you have redux, mobx, context and new stuff like recoil (which I haven‚Äôt tried yet), I won‚Äôt go into the pros/cons of each, there are a lot of resources on the web you can read that are far better than what I can write, so I‚Äôm going to go straight into the biggest problem I saw with managing state in my web/mobile apps:</p>

<p>90% of the code I wrote to do state management, did just that‚Ä¶ <strong>state management</strong>, that is:</p>

<p>1) Handle user action, set some loading flag, either on state or just on UI
2) Validate the passed thing, push it or fetch thing from server (via Rest or GraphQL)
3) Take response, sanitize it, normalize it, break it
4) Put it‚Ä¶ somewhere, follow whatever arbitrary architecture the front-end follows, the best strategy in my experience was having a normalized store, this means I had to write the code to handle a normalized store, fetch by ids, join by ids, create tests to make sure everything behaves properly, etc.</p>

<p>This is all very useless from a business point of view, none of this actions make my application better than the competition nor help me achieve any goals, it is just there for the app to function properly, you know how can I tell? because every once in a while, I will actually have to write actually valuable domain code and the difference is clear, non valuable code will look like it belongs in a RDMS, the code actually has some business logic that is valuable wouldn‚Äôt work in another app</p>

<h2 id="you-are-just-using-x-wrong">You are just using X wrong</h2>
<p>Now there are varying degrees to why each of the current solutions fail to do this:</p>

<h3 id="redux">Redux</h3>
<p>I love redux, I really do, it not only provides the mechanism it actually provides an architecture to follow, it‚Äôs 2020, we all know it‚Äôs boilerplate as hell‚Ä¶ the problem is, <em>the reducers are full of code that just puts stuff in places</em>, immerjs makes it look nicer, doesn‚Äôt make the code any more valuable‚Ä¶</p>

<h3 id="mobx-and-recoil-i-presume">Mobx (and recoil I presume)</h3>
<p>I the past I disliked Mobx, because it has many edge cases (hello async code) and also because it only provides a mechanism (the observer mechanism) and no architecture, and I‚Äôve seen first hand how teams can <strong>ABUSE</strong> and come up with layers and layers of <strong>useless arbitrary abstraction</strong>, but it is less boiler platey and seems to have nice performance on a larger scale, but I will come back to it later</p>

<h3 id="context">Context</h3>
<p>If you have to inject more than one or two context providers, welcome to arbitrary code again, with it‚Äôs own pitfalls of edge cases and workarounds</p>

<h2 id="ok-so-what-now">Ok, so what now?</h2>

<p>so, the question is what to use then? the answer is <strong>a replicated on-device database</strong>, there are many implementations and technologies one can use but it needs to fill some requirements:</p>

<ul>
  <li>It needs to abstract all the entity management away from you, you should just need to declare your model</li>
  <li>It needs to replicate itself or at least provide sane mechanism to sync to your back-end</li>
  <li>It needs to be ACID complaint or have some SQL like way to interact with the data</li>
</ul>

<p>I started using WatermelonDB, it was the first time I saw this pattern in action, the technology was not so good, brought many issues and required many workarounds (even though I claimed it scaled better when one had thousands of items and to be fair it kinda does), you also have to sync from device to your back-end, has no replication, but it did show me how this pattern is great.</p>

<ul>
  <li>I wrote 0 arbitrary ‚Äúput this thing here and this thing here‚Äù code, only when new business requirements came in I had to modify the database model, like any DB you can do migrations when the structure changes, you get strong type guarantees, etc</li>
  <li>It literally runs on SQLite, it persists by default, handles thousands of items, you know what this means? <strong>offline first app for free</strong>, you will need to define your model anyways, once it is there and can handle ALL the items you throw at it‚Ä¶ user can always use the app without connection</li>
  <li>I provided a known and battle tested way of interacting with data, instead of me writing buggy selectors/reducers/stores, one writes SQL-like queries</li>
  <li>It provided a sane sync mechanism, just one call, push data to your back-end, pull in another one, instead of having hundreds of graphql fragments or thousands of http requests, you do everything in a single pass</li>
</ul>

<p>ok, so I wouldn‚Äôt recommend anyone to use WatermelonDB, or maybe it has been updated since I used it, but right now I‚Äôm using RxDB, it is great, the API is similar but does not come with as many compromises, it can replicate itself on a couchDB instance on your back-end, but let me just clarify why this is so important, I‚Äôve had my share of fuck ups, where data from a device did not sync to our back-end, have you tried to investigate why data is not syncing from a device you have no access to with a customer that is ready to dump your app because it just costed him a day of work‚Ä¶ if you have all the data on the cloud you don‚Äôt need to send db dumps, it won‚Äôt help if you business logic is faulty, but it removes having to talk to a non-technical human out of the equation.</p>

<p>Let me just list the list of possible options (that I know of):</p>
<ul>
  <li>RealmJS, seems to be the biggest player on the react/react-native world, it was all open source, now only the client is open source/free, if you want to replicate to a back-end you have to pay them</li>
  <li>Firebase/Realtime Database, it does very nice things, it syncs auto magically, push something it appears on the user‚Äôs device, Google grade magic, but basically allows the same as the others in this list, but you are locked in to Google whims</li>
  <li>WatermelonDB, open source client only attempt, specially focused on the react-native world, has many pitfalls like blocking UI connectors and no replication, only manual sync possible</li>
  <li>RxDB, my current solution, simple non-blocking API (unfortunately also needs RxJS), can replicate to a couchDB back-end instance, and (mostly) stable, also uses SQLite so performance is great</li>
</ul>

<h2 id="what-about-the-stuff-that-i-cannot-insert-on-a-db">What about the stuff that I cannot insert on a DB</h2>

<p>There are some use cases that will not fit the DB model, transient UI data, one off flags or apps that are not heavy on entities just a lot of different data, for this stuff you can fallback to the redux, mobx, context, but if you are able to use any of the DBs mentioned and pair it, you are definitely golden, nowadays I use mobx with RxDB.</p>

<p>Why? I only need 1 (maybe 2) store(s), contains mostly shallow data: some UI flags, some piece of string, etc. this self-prevents from blowing up the architecture, it is not as boilerplate heavy as redux/context, again I don‚Äôt want to write reducers that only do: <code class="language-plaintext highlighter-rouge">{...state, [some random UI flag]: true}</code> and if my store is so small and has no crazy architecture‚Ä¶ the minimal amount of boilerplate is actually a good thing</p>

<h2 id="closing-topics">Closing topics</h2>

<p>I could go on and on about this paradigm, graphQL? meh, if everything the user needs is synced‚Ä¶ I don‚Äôt need it, I can just have one HTTP Rest endpoint, write the rest of the application as normal, no need to insert GraphQL JSX fragments everywhere‚Ä¶</p>

<p>You are now thinking <code class="language-plaintext highlighter-rouge">You are misusing/don't understand [MobX|Redux|Recoil|Context|ReduxSagas|UseReducer]</code> and I mean, sure, maybe, I don‚Äôt care, this is my experience and what works for me, you do you‚Ä¶ also, don‚Äôt use Sagas, ever.</p>

  </div>
</div>

<div class="border-t border-gray-200" ></div>

<div class="px-4 pt-20">
  <div class="text-6xl font-medium">I'm Oscar Franco;</div>
  <div class="text-4xl font-medium text-gray-500 pt-4">I do open source and lead development teams, I live in <span class="text-blue-400">Munich ü•®</span>, feel free to contact me!</div>
</div>

<div class="my-6 px-4">
  <h2 class="font-medium text-4xl py-4">Open Source</h2>
  
  <div>
    <a href="https://tempomat.dev">
      <div class="transform hover:scale-105 flex w-full items-center h-28 transition duration-200 rounded group">
        <div class="transition duration-200 overflow-hidden m-2 p-4 rounded-xl hover:shadow-xl hover:bg-white">
          <div class="font-normal text-gray-500">Tempomat [‚≠êÔ∏è 6]</div>
          <div class="font-extralight">
            macOS menu bar app that polls your continuous integration system and/or http endpoints and notifies you
            when something is broken
          </div>
        </div>
      </div>
    </a>
    
    <a href="https://github.com/ospfranco/link-preview-js">
      <div class="transform hover:scale-105 flex w-full items-center h-28 transition duration-200 group">
        <div class="transition duration-200 overflow-hidden m-2 p-4 rounded-xl hover:shadow-xl hover:bg-white">
          <div class="font-normal text-gray-500">Link Preview JS [‚≠êÔ∏è 228]</div>
          <div class="font-extralight">
            Typescript library to generate preview of http links (think twitter cards or pasting links into whatsapp)
          </div>
        </div>
      </div>
    </a>

    <a href="https://github.com/ospfranco/gh-jester">
      <div class="transform hover:scale-105 flex w-full items-center h-28 transition duration-200 group">
        <div class="transition duration-200 overflow-hidden m-2 p-4 rounded-xl hover:shadow-xl hover:bg-white">

            <div class="font-normal text-gray-500">GH Jester</div>
            <div class="font-extralight">
              Github action that posts your jest test results into PRs and commits
            </div>  
        </div>
      </div>
    </a>
  </div>
</div>

      </div>

    </div>

    <nav class="header" style="top: 0; background-color: #FBFBFB;">
      <div class="flex items-center justify-center flex-wrap content py-4 px-4 md:px-0">
        <a
          class="transition duration-500 rounded px-4 flex items-center flex-1"
          href="/"
        >
          <img src="/assets/profile.webp" class="h-12 w-12 rounded-full mr-3"/>
          <span>ospfranco</span>
        </a>
        <a
          class="transition duration-500 rounded px-4"
          href="https://twitter.com/ospfranco"
        >
          Twitter
        </a>
        <a
          class="transition duration-500 rounded px-4"
          href="https://github.com/ospfranco"
        >
          Github
        </a>
        <a
          class="transition duration-500 rounded px-4"
          href="/aboutMe"
        >
          About
        </a>
      </div>
    </nav>

  </body>
</html>
